<%  
    # Geometry
    frame_mass   = 0.01
    frame_depth  = 0.08     # X-axis
    frame_width  = 0.16     # Y-axis
    frame_height = 0.01     # Z-axis

    wing_mass   = 0.06
    wing_radius = 0.025
    wing_length = 0.15

    # Position
    frame_z = frame_height/2

    wing_y = frame_width - 0.02
    wing_z = wing_radius + frame_height
    wing_roll = (3.14159265359/2).round(6)
    wing_joint_z = wing_length/2

    # Inertia
    frame_ixx = ((1.0/12)*frame_mass*(frame_height**2 + frame_width**2)).round(10)
    frame_iyy = ((1.0/12)*frame_mass*(frame_height**2 + frame_depth**2)).round(10)
    frame_izz = ((1.0/12)*frame_mass*(frame_depth**2 + frame_width**2)).round(10)

    wing_ixx  = ((1.0/12)*wing_mass*(6.0*wing_radius**2 + wing_length**2)).round(10)
    wing_iyy  = (wing_mass*wing_radius**2).round(10)
    wing_izz  = ((1.0/12)*wing_mass*(6.0*wing_radius**2 + wing_length**2)).round(10)
%>
<?xml version='1.0'?>
<sdf version='1.4'>
    <model name='magnus_wings'>

        <link name="base_link">
            <pose>0 0 <%=frame_z%> 0 0 0</pose>
            <inertial>
                <pose>0 0 <%=frame_z%> 0 0 0</pose>
                <mass><%=frame_mass%></mass>
                <inertia>
                    <ixx><%=frame_ixx%></ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy><%=frame_iyy%></iyy>
                    <iyz>0</iyz>
                    <izz><%=frame_izz%></izz>
                </inertia>
            </inertial>
            <collision name='base_link_collision'>
                <geometry>
                    <box>
                        <size><%=frame_depth%> <%=frame_width%> <%=frame_height%></size>
                    </box>
                </geometry>
            </collision>
            <visual name='base_link_visual'>
                <geometry>
                    <box>
                        <size><%=frame_depth%> <%=frame_width%> <%=frame_height%></size>
                    </box>
                </geometry>
                <material>
                <script>
                    <name>Gazebo/DarkGrey</name>
                    <uri>file://media/materials/scripts/gazebo.material</uri>
                </script>
                </material>
            </visual>
            <gravity>1</gravity>
            <velocity_decay/>
        </link>

        <link name="left_wing">
            <pose>0 <%=wing_y%> <%=wing_z%> <%=wing_roll%> 0 0</pose>
            <inertial>
                <mass><%=wing_mass%></mass>
                <inertia>
                    <ixx><%=wing_ixx%></ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy><%=wing_iyy%></iyy>
                    <iyz>0</iyz>
                    <izz><%=wing_izz%></izz>
                </inertia>
            </inertial>
            <collision name="left_wing_collision">
                <geometry>
                    <cylinder>
                        <radius><%=wing_radius%></radius>
                        <length><%=wing_length%></length>
                    </cylinder>
                </geometry>
            </collision>
            <visual name="left_wing_visual">
                <geometry>
                    <cylinder>
                        <radius><%=wing_radius%></radius>
                        <length><%=wing_length%></length>
                    </cylinder>
                </geometry>
                <material>
                <script>
                    <name>Gazebo/Grey</name>
                    <uri>file://media/materials/scripts/gazebo.material</uri>
                </script>
                </material>
            </visual>
            <gravity>1</gravity>
            <velocity_decay/>
        </link>
        
        <joint name='left_wing_joint' type='revolute'>
            <pose>0 0 <%=wing_joint_z%> 0 0 0</pose>
            <child>left_wing</child>
            <parent>base_link</parent>
            <axis>
                <xyz>0 1 0</xyz>
                <limit>
                    <lower>-1e+16</lower>
                    <upper>1e+16</upper>
                </limit>
                <dynamics>
                    <damping>0</damping>
                    <friction>0</friction>
                    <spring_reference>0</spring_reference>
                    <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>

        <link name="right_wing">
            <pose>0 <%=-wing_y%> <%=wing_z%> <%=wing_roll%> 0 0</pose>
            <inertial>
                <mass><%=wing_mass%></mass>
                <inertia>
                    <ixx><%=wing_ixx%></ixx>
                    <ixy>0</ixy>
                    <ixz>0</ixz>
                    <iyy><%=wing_iyy%></iyy>
                    <iyz>0</iyz>
                    <izz><%=wing_izz%></izz>
                </inertia>
            </inertial>
            <collision name="right_wing_collision">
                <geometry>
                    <cylinder>
                        <radius><%=wing_radius%></radius>
                        <length><%=wing_length%></length>
                    </cylinder>
                </geometry>
            </collision>
            <visual name="right_wing_visual">
                <geometry>
                    <cylinder>
                        <radius><%=wing_radius%></radius>
                        <length><%=wing_length%></length>
                    </cylinder>
                </geometry>
                <material>
                <script>
                    <name>Gazebo/Grey</name>
                    <uri>file://media/materials/scripts/gazebo.material</uri>
                </script>
                </material>
            </visual>
            <gravity>1</gravity>
            <velocity_decay/>
        </link>

        <joint name='right_wing_joint' type='revolute'>
            <pose>0 0 <%=-wing_joint_z%> 0 0 0</pose>
            <child>right_wing</child>
            <parent>base_link</parent>
            <axis>
                <xyz>0 1 0</xyz>
                <limit>
                    <lower>-1e+16</lower>
                    <upper>1e+16</upper>
                </limit>
                <dynamics>
                    <damping>0</damping>
                    <friction>0</friction>
                    <spring_reference>0</spring_reference>
                    <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>

        <plugin name='left_wing_model' filename='libmagnus_plugin.so'>
            <robotNamespace/>
            <jointName>left_wing_joint</jointName>
            <linkName>left_wing</linkName>
            <wingRadius>0.025</wingRadius>
            <wingLegth>0.15</wingLegth>
            <wingMass>0.06</wingMass>
            <maxRotVelocity>1100</maxRotVelocity>
            <commandSubTopic>/gazebo/command/wing_speed</commandSubTopic>
            <wingSide>left</wingSide>
            <wingNumber>0</wingNumber>
            <motorSpeedPubTopic>/wing_speed/0</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
        </plugin>

        <plugin name='right_wing_model' filename='libmagnus_plugin.so'>
            <robotNamespace/>
            <jointName>right_wing_joint</jointName>
            <linkName>right_wing</linkName>
            <wingRadius>0.025</wingRadius>
            <wingLegth>0.15</wingLegth>
            <wingMass>0.06</wingMass>
            <maxRotVelocity>1100</maxRotVelocity>
            <commandSubTopic>/gazebo/command/wing_speed</commandSubTopic>
            <wingSide>right</wingSide>
            <wingNumber>1</wingNumber>
            <motorSpeedPubTopic>/wing_speed/1</motorSpeedPubTopic>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
        </plugin>

    </model>
</sdf>
  